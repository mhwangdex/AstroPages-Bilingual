---
import { languages, getAlternatePath, type Lang } from "@/i18n/ui";
import IconLanguage from "@/assets/icons/IconLanguage.svg";

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const currentPath = Astro.url.pathname;

// Get the other language
const otherLang = lang === "zh" ? "en" : "zh";
const alternatePath = getAlternatePath(currentPath, otherLang);
---

<a
  href={alternatePath}
  class="focus-outline flex items-center gap-1 p-3 sm:p-1 hover:text-accent"
  title={languages[otherLang]}
  aria-label={`Switch to ${languages[otherLang]}`}
  data-lang-switcher
  data-target-lang={otherLang}
>
  <IconLanguage class="size-6 sm:size-5" />
  <span class="sm:sr-only">{languages[otherLang]}</span>
</a>

<script>
  document.addEventListener("astro:page-load", () => {
    const langSwitchers = document.querySelectorAll("[data-lang-switcher]");
    langSwitchers.forEach((switcher) => {
      switcher.addEventListener("click", () => {
        const targetLang = switcher.getAttribute("data-target-lang");
        if (targetLang) {
          localStorage.setItem("preferredLang", targetLang);
        }
      });
    });
  });
</script>

